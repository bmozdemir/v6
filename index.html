<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ÃœrÃ¼n YÃ¶netim Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
  <style>
    @keyframes slideIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
    .modal-enter { animation: slideIn 0.3s ease-out; }
    .fade-in { animation: slideIn 0.5s ease-out; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    const { jsPDF } = window.jspdf;
    
    // Supabase baÄŸlantÄ±sÄ± - ayarlar sayfasÄ±ndan alÄ±nacak
    let supabase = null;
    
    const initSupabase = (url, key) => {
      try {
        return window.supabase.createClient(url, key);
      } catch (err) {
        console.error('Supabase baÄŸlantÄ± hatasÄ±:', err);
        return null;
      }
    };

    function App() {
      const [currentUser, setCurrentUser] = useState(null);
      const [loginForm, setLoginForm] = useState({ username: '', password: '' });
      const [page, setPage] = useState('dashboard');
      const [darkMode, setDarkMode] = useState(false);
      const [products, setProducts] = useState([]);
      const [invoices, setInvoices] = useState([]);
      const [customers, setCustomers] = useState([]);
      const [suppliers, setSuppliers] = useState([]);
      const [transactions, setTransactions] = useState([]);
      const [alerts, setAlerts] = useState([]);
      const [loading, setLoading] = useState(false);
      const [search, setSearch] = useState('');
      const [barcodeInput, setBarcodeInput] = useState('');
      const [modal, setModal] = useState('');
      const [selectedProduct, setSelectedProduct] = useState(null);
      const [dashboardData, setDashboardData] = useState(null);
      const [analyticsData, setAnalyticsData] = useState(null);
      const fileInputRef = useRef(null);
      const [posCart, setPosCart] = useState([]);
      const [posCustomer, setPosCustomer] = useState(null);
      const [posPaymentMethod, setPosPaymentMethod] = useState('cash');
      const [newCustomer, setNewCustomer] = useState({ name: '', phone: '', email: '', address: '' });
      const [newSupplier, setNewSupplier] = useState({ name: '', phone: '', email: '', address: '', notes: '' });
      const [newTransaction, setNewTransaction] = useState({ 
        type: 'expense', 
        category: '', 
        amount: '', 
        description: '', 
        date: new Date().toISOString().split('T')[0] 
      });
      const [passwordChange, setPasswordChange] = useState({ current: '', new: '', confirm: '' });
      const [scanning, setScanning] = useState(false);
      const scannerRef = useRef(null);
      const html5QrCodeRef = useRef(null);
      const [sortBy, setSortBy] = useState('name');
      const [filterCategory, setFilterCategory] = useState('all');
      const [supabaseConfig, setSupabaseConfig] = useState({ url: '', key: '' });
      const [isSupabaseConnected, setIsSupabaseConnected] = useState(false);

      useEffect(() => {
        const user = localStorage.getItem('user');
        const dark = localStorage.getItem('darkMode') === 'true';
        const savedConfig = localStorage.getItem('supabaseConfig');
        
        setDarkMode(dark);
        
        if (savedConfig) {
          const config = JSON.parse(savedConfig);
          setSupabaseConfig(config);
          supabase = initSupabase(config.url, config.key);
          if (supabase) {
            setIsSupabaseConnected(true);
          }
        }
        
        if (user && supabase) {
          setCurrentUser(JSON.parse(user));
          loadData();
        }
      }, []);

      useEffect(() => {
        console.log('Modal state deÄŸiÅŸti:', modal);
      }, [modal]);

      useEffect(() => {
        document.body.style.background = darkMode ? '#1a202c' : '#f7fafc';
        document.body.style.color = darkMode ? '#e2e8f0' : '#1a202c';
        localStorage.setItem('darkMode', darkMode);
      }, [darkMode]);

      const handleLogin = async () => {
        if (!supabase) {
          alert('âš ï¸ Ã–nce Supabase baÄŸlantÄ±sÄ±nÄ± yapÄ±landÄ±rÄ±n!');
          setPage('settings');
          return;
        }
        if (!loginForm.username || !loginForm.password) {
          return alert('âŒ KullanÄ±cÄ± adÄ± ve ÅŸifre gerekli!');
        }
        try {
          setLoading(true);
          const { data, error } = await supabase
            .from('users')
            .select('*')
            .eq('username', loginForm.username)
            .eq('password', loginForm.password)
            .single();
          
          if (error || !data) {
            alert('âŒ HatalÄ± kullanÄ±cÄ± adÄ± veya ÅŸifre!');
            return;
          }
          
          setCurrentUser(data);
          localStorage.setItem('user', JSON.stringify(data));
          setPage('dashboard');
          loadData();
        } catch (err) {
          console.error(err);
          alert('âŒ GiriÅŸ hatasÄ±! Supabase baÄŸlantÄ±sÄ±nÄ± kontrol edin.');
        } finally {
          setLoading(false);
        }
      };

      const loadData = async () => {
        setLoading(true);
        try {
          const [p, i, c, s, t, a] = await Promise.all([
            supabase.from('products').select('*').order('name'),
            supabase.from('invoices').select('*').order('created_at', { ascending: false }),
            supabase.from('customers').select('*').order('name'),
            supabase.from('suppliers').select('*').order('name'),
            supabase.from('transactions').select('*').order('date', { ascending: false }),
            supabase.from('stock_alerts').select('*').eq('is_read', false)
          ]);

          if (p.data) setProducts(p.data);
          if (c.data) setCustomers(c.data);
          if (s.data) setSuppliers(s.data);
          if (t.data) setTransactions(t.data);
          if (a.data) setAlerts(a.data);
          
          if (i.data) {
            const inv = await Promise.all(i.data.map(async (inv) => {
              const { data } = await supabase.from('invoice_items').select('*').eq('invoice_id', inv.id);
              return { ...inv, products: data || [] };
            }));
            setInvoices(inv);
          }

          const today = new Date().toDateString();
          const todaySales = i.data?.filter(inv => new Date(inv.invoice_date).toDateString() === today) || [];
          const todayTotal = todaySales.reduce((sum, inv) => sum + (parseFloat(inv.total_amount) || 0), 0);
          const lowStock = p.data?.filter(pr => pr.current_stock <= (pr.min_stock || 5)) || [];

          const productSales = {};
          i.data?.forEach(inv => {
            inv.products?.forEach(item => {
              productSales[item.name] = (productSales[item.name] || 0) + (item.quantity || 0);
            });
          });
          const topProducts = Object.entries(productSales).sort((a, b) => b[1] - a[1]).slice(0, 5);

          const categorySales = {};
          p.data?.forEach(pr => {
            if (pr.category) {
              categorySales[pr.category] = (categorySales[pr.category] || 0) + (pr.current_stock * pr.price || 0);
            }
          });

          const totalIncome = t.data?.filter(tr => tr.type === 'income').reduce((sum, tr) => sum + parseFloat(tr.amount || 0), 0) || 0;
          const totalExpense = t.data?.filter(tr => tr.type === 'expense').reduce((sum, tr) => sum + parseFloat(tr.amount || 0), 0) || 0;

          setDashboardData({
            todaySales: todayTotal,
            todayOrders: todaySales.length,
            lowStockCount: lowStock.length,
            lowStockProducts: lowStock.slice(0, 5),
            totalProducts: p.data?.length || 0,
            totalCustomers: c.data?.length || 0,
            totalSuppliers: s.data?.length || 0,
            totalIncome,
            totalExpense,
            profit: totalIncome - totalExpense
          });

          setAnalyticsData({ topProducts, categorySales });
        } catch (err) {
          console.error('Veri yÃ¼kleme hatasÄ±:', err);
          alert('âš ï¸ Veriler yÃ¼klenirken hata oluÅŸtu. Supabase baÄŸlantÄ±nÄ±zÄ± kontrol edin.');
        }
        setLoading(false);
      };

      const changePassword = async () => {
        if (!passwordChange.current || !passwordChange.new || !passwordChange.confirm) {
          return alert('âŒ TÃ¼m alanlarÄ± doldurun!');
        }
        if (passwordChange.new.length < 6) {
          return alert('âŒ Yeni ÅŸifre en az 6 karakter olmalÄ±!');
        }
        if (passwordChange.new !== passwordChange.confirm) {
          return alert('âŒ Yeni ÅŸifreler eÅŸleÅŸmiyor!');
        }
        if (passwordChange.current !== currentUser.password) {
          return alert('âŒ Mevcut ÅŸifre yanlÄ±ÅŸ!');
        }
        try {
          await supabase.from('users').update({ password: passwordChange.new }).eq('id', currentUser.id);
          const updatedUser = { ...currentUser, password: passwordChange.new };
          setCurrentUser(updatedUser);
          localStorage.setItem('user', JSON.stringify(updatedUser));
          alert('âœ… Åifre baÅŸarÄ±yla deÄŸiÅŸtirildi!');
          setPasswordChange({ current: '', new: '', confirm: '' });
          setModal('');
        } catch (err) {
          console.error(err);
          alert('âŒ Åifre deÄŸiÅŸtirme hatasÄ±!');
        }
      };

      const addSupplier = async () => {
        if (!newSupplier.name) return alert('âŒ TedarikÃ§i ismi gerekli!');
        try {
          await supabase.from('suppliers').insert(newSupplier);
          alert('âœ… TedarikÃ§i eklendi!');
          setNewSupplier({ name: '', phone: '', email: '', address: '', notes: '' });
          setModal('');
          loadData();
        } catch (err) {
          console.error(err);
          alert('âŒ Ekleme hatasÄ±!');
        }
      };

      const addTransaction = async () => {
        if (!newTransaction.category || !newTransaction.amount) {
          return alert('âŒ Kategori ve tutar gerekli!');
        }
        if (parseFloat(newTransaction.amount) <= 0) {
          return alert('âŒ Tutar sÄ±fÄ±rdan bÃ¼yÃ¼k olmalÄ±!');
        }
        try {
          await supabase.from('transactions').insert({ 
            ...newTransaction, 
            user_id: currentUser.id,
            amount: parseFloat(newTransaction.amount)
          });
          alert('âœ… Ä°ÅŸlem eklendi!');
          setNewTransaction({ 
            type: 'expense', 
            category: '', 
            amount: '', 
            description: '', 
            date: new Date().toISOString().split('T')[0] 
          });
          setModal('');
          loadData();
        } catch (err) {
          console.error(err);
          alert('âŒ Ekleme hatasÄ±!');
        }
      };

      const autoBackup = () => {
        const backup = { 
          date: new Date().toISOString(), 
          products, 
          invoices, 
          customers, 
          suppliers, 
          transactions 
        };
        const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `yedek_${new Date().toISOString().split('T')[0]}_${Date.now()}.json`;
        a.click();
        URL.revokeObjectURL(url);
        alert('âœ… Yedek baÅŸarÄ±yla oluÅŸturuldu!');
      };

      const addCustomer = async () => {
        if (!newCustomer.name || !newCustomer.phone) {
          return alert('âŒ Ad ve telefon numarasÄ± gerekli!');
        }
        if (newCustomer.phone.length < 10) {
          return alert('âŒ GeÃ§erli bir telefon numarasÄ± girin!');
        }
        try {
          await supabase.from('customers').insert(newCustomer);
          alert('âœ… MÃ¼ÅŸteri eklendi!');
          setNewCustomer({ name: '', phone: '', email: '', address: '' });
          setModal('');
          loadData();
        } catch (err) {
          console.error(err);
          alert('âŒ Ekleme hatasÄ±!');
        }
      };

      const generatePDFInvoice = (invoice) => {
        try {
          const doc = new jsPDF();
          doc.setFontSize(20);
          doc.text('FATURA', 105, 20, { align: 'center' });
          doc.setFontSize(10);
          doc.text('ÃœrÃ¼n YÃ¶netim Pro', 20, 40);
          doc.text(`Fatura No: ${invoice.invoice_number}`, 140, 40);
          doc.text(`Tarih: ${new Date(invoice.invoice_date).toLocaleDateString('tr-TR')}`, 140, 45);
          
          if (invoice.customer_name) {
            doc.text(`MÃ¼ÅŸteri: ${invoice.customer_name}`, 20, 50);
          }
          
          let y = 70;
          doc.setFontSize(9);
          doc.text('#', 20, y);
          doc.text('ÃœrÃ¼n', 30, y);
          doc.text('Fiyat', 100, y);
          doc.text('Adet', 130, y);
          doc.text('Toplam', 160, y);
          y += 5;
          doc.line(20, y, 190, y);
          y += 10;
          
          invoice.products?.forEach((p, i) => {
            doc.text((i + 1).toString(), 20, y);
            doc.text(p.name.substring(0, 30), 30, y);
            doc.text(`${p.price} TL`, 100, y);
            doc.text((p.quantity || p.stock || 0).toString(), 130, y);
            doc.text(`${((p.price || 0) * (p.quantity || p.stock || 0)).toFixed(2)} TL`, 160, y);
            y += 7;
            if (y > 270) {
              doc.addPage();
              y = 20;
            }
          });
          
          y += 10;
          doc.line(20, y, 190, y);
          y += 10;
          doc.setFontSize(14);
          doc.text(`TOPLAM: ${(invoice.total_amount || 0).toFixed(2)} TL`, 140, y);
          
          doc.save(`fatura_${invoice.invoice_number}.pdf`);
          alert('âœ… Fatura indirildi!');
        } catch (err) {
          console.error(err);
          alert('âŒ PDF oluÅŸturma hatasÄ±!');
        }
      };

      const generateBarcodeLabels = () => {
        const barcoded = products.filter(p => p.barcode);
        if (!barcoded.length) return alert('âŒ Barkodlu Ã¼rÃ¼n bulunamadÄ±!');
        
        try {
          const doc = new jsPDF();
          let y = 20;
          let count = 0;
          
          barcoded.slice(0, 20).forEach((p, i) => {
            if (count > 0 && count % 4 === 0) { 
              doc.addPage(); 
              y = 20; 
            }
            
            const canvas = document.createElement('canvas');
            JsBarcode(canvas, p.barcode, { 
              format: 'CODE128', 
              width: 2, 
              height: 40, 
              displayValue: true 
            });
            
            doc.addImage(canvas.toDataURL('image/png'), 'PNG', 20, y, 80, 30);
            doc.setFontSize(10);
            doc.text(p.name.substring(0, 30), 20, y + 35);
            doc.text(`${p.price} TL`, 20, y + 40);
            
            y += 60;
            count++;
          });
          
          doc.save('barkod_etiketleri.pdf');
          alert('âœ… Barkod etiketleri indirildi!');
        } catch (err) {
          console.error(err);
          alert('âŒ Barkod oluÅŸturma hatasÄ±!');
        }
      };

      const addToCart = (product) => {
        if (product.current_stock <= 0) {
          return alert('âŒ Stokta yok!');
        }
        
        const existing = posCart.find(item => item.id === product.id);
        if (existing) {
          if (existing.quantity >= product.current_stock) {
            return alert('âŒ Yetersiz stok!');
          }
          setPosCart(posCart.map(item => 
            item.id === product.id 
              ? { ...item, quantity: item.quantity + 1, total: (item.quantity + 1) * item.price } 
              : item
          ));
        } else {
          setPosCart([...posCart, { ...product, quantity: 1, total: product.price }]);
        }
      };

      const removeFromCart = (productId) => {
        setPosCart(posCart.filter(item => item.id !== productId));
      };

      const updateCartQuantity = (productId, newQty) => {
        if (newQty <= 0) { 
          removeFromCart(productId); 
          return; 
        }
        
        const product = products.find(p => p.id === productId);
        if (newQty > product.current_stock) {
          alert('âŒ Yetersiz stok!');
          return;
        }
        
        setPosCart(posCart.map(item => 
          item.id === productId 
            ? { ...item, quantity: newQty, total: newQty * item.price } 
            : item
        ));
      };

      const completePOSSale = async () => {
        if (!posCart.length) return alert('âŒ Sepet boÅŸ!');
        
        if (!confirm(`${posCart.reduce((s, i) => s + i.total, 0).toFixed(2)} TL satÄ±ÅŸÄ± onaylÄ±yor musunuz?`)) {
          return;
        }
        
        try {
          const invoiceNumber = `POS-${Date.now()}`;
          const totalAmount = posCart.reduce((sum, item) => sum + item.total, 0);
          
          const { data: newInvoice } = await supabase.from('invoices').insert({
            invoice_number: invoiceNumber,
            invoice_date: new Date().toISOString().split('T')[0],
            depot: 'POS',
            total_amount: totalAmount,
            product_count: posCart.length,
            customer_id: posCustomer?.id || null,
            payment_method: posPaymentMethod
          }).select().single();

          for (const item of posCart) {
            await supabase.from('products').update({ 
              current_stock: item.current_stock - item.quantity 
            }).eq('id', item.id);
            
            await supabase.from('stock_movements').insert({
              product_id: item.id,
              movement_type: 'out',
              quantity: item.quantity,
              user_id: currentUser.id,
              notes: `POS SatÄ±ÅŸ: ${invoiceNumber}`
            });
            
            await supabase.from('invoice_items').insert({
              invoice_id: newInvoice.id,
              product_id: item.id,
              quantity: item.quantity,
              unit_price: item.price,
              total_price: item.total
            });
          }

          alert(`âœ… SatÄ±ÅŸ tamamlandÄ±!\nToplam: ${totalAmount.toFixed(2)} TL\nÃ–deme: ${posPaymentMethod === 'cash' ? 'Nakit' : posPaymentMethod === 'card' ? 'Kart' : 'Havale'}`);
          
          if (confirm('FiÅŸ yazdÄ±rmak ister misiniz?')) {
            generatePDFInvoice({ 
              ...newInvoice, 
              products: posCart.map(item => ({ 
                name: item.name, 
                price: item.price, 
                quantity: item.quantity, 
                total: item.total 
              })),
              customer_name: posCustomer?.name
            });
          }
          
          setPosCart([]);
          setPosCustomer(null);
          setPosPaymentMethod('cash');
          loadData();
        } catch (err) {
          console.error(err);
          alert('âŒ SatÄ±ÅŸ hatasÄ±!');
        }
      };

      const handleExcelImport = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = async (event) => {
          try {
            const workbook = XLSX.read(new Uint8Array(event.target.result), { type: 'array' });
            const jsonData = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
            
            if (!jsonData.length) return alert('âŒ Excel dosyasÄ± boÅŸ!');
            
            let updated = 0, inserted = 0, errors = 0;
            
            for (const row of jsonData) {
              try {
                const barcode = row.barkod || row.barcode || row.Barkod || row.Barcode;
                const name = row.urun || row.name || row['ÃœrÃ¼n AdÄ±'] || row.Name;
                const price = parseFloat(row.fiyat || row.price || row.Fiyat || row.Price || 0);
                const stock = parseInt(row.stok || row.stock || row.Stok || row.Stock || 0);
                const category = row.kategori || row.category || row.Kategori || row.Category || 'Genel';
                
                if (!name) {
                  errors++;
                  continue;
                }
                
                if (barcode) {
                  const { data: existing } = await supabase
                    .from('products')
                    .select('*')
                    .eq('barcode', barcode)
                    .single();
                  
                  if (existing) {
                    await supabase.from('products').update({ 
                      name, 
                      price, 
                      current_stock: stock,
                      category,
                      total: price * stock 
                    }).eq('id', existing.id);
                    updated++;
                  } else {
                    await supabase.from('products').insert({ 
                      name, 
                      price, 
                      current_stock: stock, 
                      barcode, 
                      category,
                      min_stock: 5,
                      total: price * stock 
                    });
                    inserted++;
                  }
                } else {
                  await supabase.from('products').insert({ 
                    name, 
                    price, 
                    current_stock: stock, 
                    category,
                    min_stock: 5,
                    total: price * stock 
                  });
                  inserted++;
                }
              } catch (rowErr) {
                console.error('SatÄ±r hatasÄ±:', rowErr);
                errors++;
              }
            }
            
            alert(`âœ… Ä°Ã§e aktarma tamamlandÄ±!\nğŸ“¥ Yeni: ${inserted}\nğŸ”„ GÃ¼ncellenen: ${updated}\nâŒ Hata: ${errors}`);
            loadData();
            if (fileInputRef.current) fileInputRef.current.value = '';
          } catch (err) {
            console.error(err);
            alert('âŒ Excel okuma hatasÄ±!');
          }
        };
        reader.readAsArrayBuffer(file);
      };

      const startScanner = () => {
        setModal('scanner');
        setTimeout(() => {
          if (!html5QrCodeRef.current && scannerRef.current) {
            html5QrCodeRef.current = new Html5Qrcode("reader");
            html5QrCodeRef.current.start(
              { facingMode: "environment" }, 
              { fps: 10, qrbox: { width: 250, height: 250 } }, 
              (text) => {
                stopScanner();
                searchByBarcode(text);
              }, 
              () => {}
            ).catch((err) => { 
              console.error(err);
              alert("âŒ Kamera eriÅŸim hatasÄ±!"); 
              setModal(''); 
            });
          }
        }, 100);
      };

      const stopScanner = () => {
        if (html5QrCodeRef.current) {
          html5QrCodeRef.current.stop().then(() => { 
            html5QrCodeRef.current = null; 
            setModal(''); 
          }).catch(console.error);
        }
      };

      const searchByBarcode = async (barcode) => {
        if (!barcode) return;
        
        try {
          const { data } = await supabase
            .from('products')
            .select('*')
            .eq('barcode', barcode.trim())
            .single();
          
          if (data) {
            if (page === 'pos') {
              addToCart(data);
              alert(`âœ… Eklendi: ${data.name}`);
            } else { 
              setSelectedProduct(data); 
              setModal('detail'); 
            }
          } else {
            alert(`âŒ ÃœrÃ¼n bulunamadÄ±: ${barcode}`);
          }
        } catch (err) {
          console.error(err);
          alert(`âŒ Arama hatasÄ±: ${barcode}`);
        }
        
        setBarcodeInput('');
      };

      const addStockMovement = async (type, qty) => {
        if (!qty || qty <= 0) {
          return alert('âŒ GeÃ§erli bir miktar girin!');
        }
        
        try {
          let newStock = selectedProduct.current_stock;
          
          if (type === 'in') {
            newStock += qty;
          } else if (type === 'out') {
            if (qty > newStock) return alert('âŒ Yetersiz stok!');
            newStock -= qty;
          }
          
          await supabase.from('products').update({ 
            current_stock: newStock 
          }).eq('id', selectedProduct.id);
          
          await supabase.from('stock_movements').insert({ 
            product_id: selectedProduct.id, 
            movement_type: type, 
            quantity: qty, 
            user_id: currentUser.id,
            notes: type === 'in' ? 'Stok giriÅŸi' : 'Stok Ã§Ä±kÄ±ÅŸÄ±'
          });
          
          alert('âœ… Stok gÃ¼ncellendi!');
          setModal('');
          loadData();
        } catch (err) {
          console.error(err);
          alert('âŒ GÃ¼ncelleme hatasÄ±!');
        }
      };

      const deleteProduct = async (productId) => {
        if (!confirm('Bu Ã¼rÃ¼nÃ¼ silmek istediÄŸinize emin misiniz?')) return;
        
        try {
          await supabase.from('products').delete().eq('id', productId);
          alert('âœ… ÃœrÃ¼n silindi!');
          setModal('');
          loadData();
        } catch (err) {
          console.error(err);
          alert('âŒ Silme hatasÄ±!');
        }
      };

      const markAlertsAsRead = async () => {
        try {
          await supabase.from('stock_alerts').update({ is_read: true }).eq('is_read', false);
          setAlerts([]);
          setModal('');
          alert('âœ… Bildirimler okundu olarak iÅŸaretlendi!');
        } catch (err) {
          console.error(err);
        }
      };

      const exportToExcel = () => {
        try {
          const ws = XLSX.utils.json_to_sheet(products.map(p => ({
            'ÃœrÃ¼n AdÄ±': p.name,
            'Barkod': p.barcode || '',
            'Fiyat': p.price,
            'Stok': p.current_stock,
            'Kategori': p.category || '',
            'Min Stok': p.min_stock || 5
          })));
          
          const wb = XLSX.utils.book_new();
          XLSX.utils.book_append_sheet(wb, ws, 'ÃœrÃ¼nler');
          XLSX.writeFile(wb, `urunler_${new Date().toISOString().split('T')[0]}.xlsx`);
          alert('âœ… Excel dosyasÄ± indirildi!');
        } catch (err) {
          console.error(err);
          alert('âŒ DÄ±ÅŸa aktarma hatasÄ±!');
        }
      };

      const saveSupabaseConfig = () => {
        if (!supabaseConfig.url || !supabaseConfig.key) {
          return alert('âŒ URL ve Key alanlarÄ± zorunludur!');
        }
        
        if (!supabaseConfig.url.includes('supabase.co')) {
          return alert('âŒ GeÃ§ersiz Supabase URL! Ã–rnek: https://xxx.supabase.co');
        }
        
        try {
          localStorage.setItem('supabaseConfig', JSON.stringify(supabaseConfig));
          supabase = initSupabase(supabaseConfig.url, supabaseConfig.key);
          
          if (supabase) {
            setIsSupabaseConnected(true);
            alert('âœ… Supabase baÄŸlantÄ±sÄ± baÅŸarÄ±lÄ±!');
            setModal('');
          } else {
            alert('âŒ BaÄŸlantÄ± kurulamadÄ±!');
          }
        } catch (err) {
          console.error(err);
          alert('âŒ Kaydetme hatasÄ±!');
        }
      };

      const testSupabaseConnection = async () => {
        if (!supabase) {
          return alert('âš ï¸ Ã–nce ayarlarÄ± kaydedin!');
        }
        
        try {
          const { data, error } = await supabase.from('users').select('count');
          if (error) throw error;
          alert('âœ… BaÄŸlantÄ± baÅŸarÄ±lÄ±! VeritabanÄ±na eriÅŸim saÄŸlandÄ±.');
        } catch (err) {
          console.error(err);
          alert('âŒ BaÄŸlantÄ± hatasÄ±! LÃ¼tfen ayarlarÄ±nÄ±zÄ± kontrol edin.');
        }
      };

      let filtered = products.filter(p => 
        (p.name?.toLowerCase().includes(search.toLowerCase()) || 
         p.barcode?.includes(search) ||
         p.category?.toLowerCase().includes(search.toLowerCase()))
      );

      if (filterCategory !== 'all') {
        filtered = filtered.filter(p => p.category === filterCategory);
      }

      if (sortBy === 'name') {
        filtered.sort((a, b) => a.name.localeCompare(b.name));
      } else if (sortBy === 'price') {
        filtered.sort((a, b) => b.price - a.price);
      } else if (sortBy === 'stock') {
        filtered.sort((a, b) => a.current_stock - b.current_stock);
      }

      const categories = [...new Set(products.map(p => p.category).filter(Boolean))];

      if (!currentUser) {
        return (
          <>
            <div className="min-h-screen bg-gradient-to-br from-blue-500 via-purple-500 to-pink-500 flex items-center justify-center p-4">
              <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md fade-in">
                <div className="text-center mb-8">
                  <div className="text-6xl mb-4">ğŸª</div>
                  <h1 className="text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                    ÃœrÃ¼n YÃ¶netim Pro
                  </h1>
                  <p className="text-gray-500 mt-2">Profesyonel Stok ve SatÄ±ÅŸ YÃ¶netimi</p>
                </div>
                
                {!isSupabaseConnected ? (
                  <div className="space-y-4">
                    <div className="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4">
                      <p className="text-yellow-800 text-center font-semibold mb-2">âš ï¸ VeritabanÄ± BaÄŸlantÄ±sÄ± Gerekli</p>
                      <p className="text-sm text-yellow-700 text-center">Devam etmek iÃ§in Ã¶nce Supabase ayarlarÄ±nÄ±zÄ± yapÄ±landÄ±rÄ±n</p>
                    </div>
                    
                    <button
                      type="button"
                      onClick={(e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('Buton tÄ±klandÄ±!');
                        setModal('supabaseSettings');
                      }}
                      className="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg hover:shadow-lg font-semibold transition cursor-pointer"
                      style={{ pointerEvents: 'auto' }}
                    >
                      âš™ï¸ Supabase AyarlarÄ±nÄ± Yap
                    </button>
                    
                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                      <p className="text-sm text-gray-600 mb-2"><strong>ğŸ“ Supabase NasÄ±l Kurulur?</strong></p>
                      <ol className="text-xs text-gray-600 space-y-1 list-decimal list-inside">
                        <li>supabase.com adresine gidin</li>
                        <li>Ãœcretsiz hesap oluÅŸturun</li>
                        <li>Yeni proje oluÅŸturun</li>
                        <li>Settings â†’ API â†’ URL ve anon key'i kopyalayÄ±n</li>
                        <li>YukarÄ±daki butona tÄ±klayÄ±p yapÄ±ÅŸtÄ±rÄ±n</li>
                      </ol>
                    </div>
                  </div>
                ) : (
                  <>
                    <input 
                      type="text" 
                      placeholder="ğŸ‘¤ KullanÄ±cÄ± AdÄ±" 
                      value={loginForm.username} 
                      onChange={e => setLoginForm({...loginForm, username: e.target.value})} 
                      className="w-full px-4 py-3 border-2 rounded-lg mb-3 focus:border-blue-500 outline-none transition"
                    />
                    
                    <input 
                      type="password" 
                      placeholder="ğŸ”’ Åifre" 
                      value={loginForm.password} 
                      onChange={e => setLoginForm({...loginForm, password: e.target.value})} 
                      onKeyPress={e => e.key === 'Enter' && handleLogin()} 
                      className="w-full px-4 py-3 border-2 rounded-lg mb-4 focus:border-blue-500 outline-none transition"
                    />
                    
                    <button 
                      onClick={handleLogin} 
                      disabled={loading}
                      className="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg hover:shadow-lg font-semibold transition disabled:opacity-50 mb-3"
                    >
                      {loading ? 'â³ GiriÅŸ yapÄ±lÄ±yor...' : 'ğŸš€ GiriÅŸ Yap'}
                    </button>
                    
                    <button
                      type="button"
                      onClick={(e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        setModal('supabaseSettings');
                      }}
                      className="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 py-2 rounded-lg text-sm transition cursor-pointer"
                      style={{ pointerEvents: 'auto' }}
                    >
                      âš™ï¸ Supabase AyarlarÄ±
                    </button>
                    
                    <div className="mt-6 p-4 bg-blue-50 rounded-lg">
                      <p className="text-center text-sm text-gray-600">
                        <strong>Demo Hesap:</strong><br/>
                        KullanÄ±cÄ±: admin<br/>
                        Åifre: admin123
                      </p>
                    </div>
                  </>
                )}
              </div>
            </div>

            {/* Supabase Settings Modal - Login ekranÄ±nda da Ã§alÄ±ÅŸmasÄ± iÃ§in */}
            {modal === 'supabaseSettings' && (
              <div 
                className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[9999] modal-enter"
                onClick={(e) => {
                  if (e.target === e.currentTarget) {
                    setModal('');
                  }
                }}
              >
                <div className="bg-white rounded-xl p-6 w-full max-w-2xl text-black max-h-[90vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
                  <h2 className="text-2xl font-bold mb-4">ğŸ”— Supabase VeritabanÄ± AyarlarÄ±</h2>
                  
                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold mb-2">Supabase Project URL *</label>
                      <input
                        type="text"
                        placeholder="https://xxxxx.supabase.co"
                        value={supabaseConfig.url}
                        onChange={e => setSupabaseConfig({...supabaseConfig, url: e.target.value})}
                        className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 outline-none"
                      />
                    </div>
                    
                    <div>
                      <label className="block text-sm font-semibold mb-2">Anon Public Key *</label>
                      <textarea
                        placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                        value={supabaseConfig.key}
                        onChange={e => setSupabaseConfig({...supabaseConfig, key: e.target.value})}
                        className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 outline-none font-mono text-xs"
                        rows={5}
                      ></textarea>
                    </div>
                  </div>
                  
                  <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-4 mb-6">
                    <p className="text-sm font-semibold text-blue-900 mb-2">ğŸ“‹ NasÄ±l Bulabilirim?</p>
                    <ol className="text-xs text-blue-800 space-y-1 list-decimal list-inside">
                      <li>supabase.com adresine gidip giriÅŸ yapÄ±n</li>
                      <li>Projenizi seÃ§in</li>
                      <li>Sol menÃ¼den "Settings" â†’ "API" sayfasÄ±na gidin</li>
                      <li>"Project URL" ve "anon public" key'i kopyalayÄ±n</li>
                      <li>YukarÄ±daki alanlara yapÄ±ÅŸtÄ±rÄ±n</li>
                    </ol>
                  </div>
                  
                  <div className="flex gap-3">
                    <button
                      type="button"
                      onClick={(e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        saveSupabaseConfig();
                      }}
                      className="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold transition"
                    >
                      âœ… Kaydet ve BaÄŸlan
                    </button>
                    <button
                      type="button"
                      onClick={(e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        setModal('');
                      }}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 py-3 rounded-lg font-semibold transition"
                    >
                      âŒ Ä°ptal
                    </button>
                  </div>
                </div>
              </div>
            )}
          </>
        );
      }

      if (loading) {
        return (
          <div className="min-h-screen flex items-center justify-center">
            <div className="text-center">
              <div className="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto mb-4"></div>
              <p className="text-xl font-semibold">YÃ¼kleniyor...</p>
            </div>
          </div>
        );
      }

      return (
        <div className={darkMode ? 'min-h-screen bg-gray-900 text-white' : 'min-h-screen bg-gray-100'}>
          <nav className={darkMode ? 'bg-gray-800 shadow-lg mb-6' : 'bg-white shadow-lg mb-6'}>
            <div className="max-w-7xl mx-auto px-4 sm:px-6 py-4">
              <div className="flex justify-between items-center flex-wrap gap-3">
                <div className="flex gap-2 flex-wrap">
                  {[
                    { id: 'dashboard', icon: 'ğŸ“Š', label: 'Panel' },
                    { id: 'pos', icon: 'ğŸ›’', label: 'POS' },
                    { id: 'products', icon: 'ğŸ“¦', label: 'ÃœrÃ¼nler' },
                    { id: 'invoices', icon: 'ğŸ“„', label: 'Faturalar' },
                    { id: 'customers', icon: 'ğŸ‘¥', label: 'MÃ¼ÅŸteriler' },
                    { id: 'suppliers', icon: 'ğŸ­', label: 'TedarikÃ§i' },
                    { id: 'finance', icon: 'ğŸ’°', label: 'Finans' },
                    { id: 'analytics', icon: 'ğŸ“ˆ', label: 'Analiz' },
                    { id: 'settings', icon: 'âš™ï¸', label: 'Ayarlar' }
                  ].map(p => (
                    <button 
                      key={p.id} 
                      onClick={() => setPage(p.id)} 
                      className={`px-3 py-2 rounded-lg text-sm font-medium transition ${
                        page === p.id 
                          ? 'bg-blue-600 text-white shadow-md' 
                          : darkMode ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-600 hover:bg-gray-100'
                      }`}
                    >
                      <span className="hidden sm:inline">{p.icon} {p.label}</span>
                      <span className="sm:hidden">{p.icon}</span>
                    </button>
                  ))}
                </div>
                
                <div className="flex items-center gap-2 flex-wrap">
                  <button 
                    onClick={() => setDarkMode(!darkMode)} 
                    className={`px-3 py-2 rounded-lg transition ${darkMode ? 'bg-yellow-500 hover:bg-yellow-600' : 'bg-gray-700 hover:bg-gray-800'} text-white`}
                  >
                    {darkMode ? 'â˜€ï¸' : 'ğŸŒ™'}
                  </button>
                  
                  <button 
                    onClick={autoBackup} 
                    className="px-3 py-2 rounded-lg bg-green-600 hover:bg-green-700 text-white text-sm transition"
                    title="Yedek Al"
                  >
                    ğŸ’¾
                  </button>
                  
                  <button 
                    onClick={() => setModal('changePassword')} 
                    className="px-3 py-2 rounded-lg bg-purple-600 hover:bg-purple-700 text-white text-sm transition"
                    title="Åifre DeÄŸiÅŸtir"
                  >
                    ğŸ”
                  </button>
                  
                  <span className="text-sm font-medium hidden sm:inline">
                    ğŸ‘¤ {currentUser.full_name}
                  </span>
                  
                  {alerts.length > 0 && (
                    <button 
                      onClick={() => setModal('alerts')} 
                      className="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm font-semibold transition animate-pulse"
                    >
                      ğŸ”” {alerts.length}
                    </button>
                  )}
                  
                  <button 
                    onClick={() => { 
                      if (confirm('Ã‡Ä±kÄ±ÅŸ yapmak istediÄŸinize emin misiniz?')) {
                        setCurrentUser(null); 
                        localStorage.removeItem('user'); 
                      }
                    }} 
                    className="bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded-lg text-sm text-black font-medium transition"
                  >
                    ğŸšª Ã‡Ä±kÄ±ÅŸ
                  </button>
                </div>
              </div>
            </div>
          </nav>

          <div className="max-w-7xl mx-auto px-4 sm:px-6 pb-12">
            {page === 'dashboard' && dashboardData && (
              <div className="space-y-6 fade-in">
                <div className="flex justify-between items-center">
                  <h1 className="text-3xl font-bold">ğŸ“Š Dashboard</h1>
                  <p className="text-sm text-gray-500">
                    {new Date().toLocaleDateString('tr-TR', { 
                      weekday: 'long', 
                      year: 'numeric', 
                      month: 'long', 
                      day: 'numeric' 
                    })}
                  </p>
                </div>
                
                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6">
                  <div className="bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl p-6 shadow-xl hover:shadow-2xl transition">
                    <p className="text-sm opacity-80 mb-1">BugÃ¼nkÃ¼ SatÄ±ÅŸ</p>
                    <p className="text-3xl font-bold">{dashboardData.todaySales.toFixed(2)} â‚º</p>
                    <p className="text-xs mt-2 opacity-70">{dashboardData.todayOrders} sipariÅŸ</p>
                  </div>
                  
                  <div className="bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl p-6 shadow-xl hover:shadow-2xl transition">
                    <p className="text-sm opacity-80 mb-1">Net KÃ¢r</p>
                    <p className="text-3xl font-bold">{dashboardData.profit.toFixed(2)} â‚º</p>
                    <p className="text-xs mt-2 opacity-70">
                      Gelir: {dashboardData.totalIncome.toFixed(0)} â‚º
                    </p>
                  </div>
                  
                  <div className="bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-xl p-6 shadow-xl hover:shadow-2xl transition">
                    <p className="text-sm opacity-80 mb-1">Toplam MÃ¼ÅŸteri</p>
                    <p className="text-3xl font-bold">{dashboardData.totalCustomers}</p>
                    <p className="text-xs mt-2 opacity-70">{dashboardData.totalSuppliers} tedarikÃ§i</p>
                  </div>
                  
                  <div className="bg-gradient-to-br from-red-500 to-red-600 text-white rounded-xl p-6 shadow-xl hover:shadow-2xl transition">
                    <p className="text-sm opacity-80 mb-1">DÃ¼ÅŸÃ¼k Stok UyarÄ±sÄ±</p>
                    <p className="text-3xl font-bold">{dashboardData.lowStockCount}</p>
                    <p className="text-xs mt-2 opacity-70">{dashboardData.totalProducts} toplam Ã¼rÃ¼n</p>
                  </div>
                </div>

                {dashboardData.lowStockProducts.length > 0 && (
                  <div className="bg-red-50 border-2 border-red-200 rounded-xl p-6">
                    <h3 className="text-xl font-bold text-red-800 mb-4">âš ï¸ DÃ¼ÅŸÃ¼k Stoklu ÃœrÃ¼nler</h3>
                    <div className="space-y-2">
                      {dashboardData.lowStockProducts.map(p => (
                        <div key={p.id} className="flex justify-between items-center bg-white p-4 rounded-lg hover:shadow-md transition">
                          <div>
                            <p className="font-semibold text-black">{p.name}</p>
                            <p className="text-sm text-gray-600">
                              Mevcut: {p.current_stock} | Minimum: {p.min_stock || 5}
                            </p>
                          </div>
                          <div className="flex items-center gap-2">
                            <span className="bg-red-500 text-white px-3 py-1 rounded-full text-sm font-semibold">
                              Kritik
                            </span>
                            <button 
                              onClick={() => { setSelectedProduct(p); setModal('detail'); }}
                              className="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition"
                            >
                              GÃ¶rÃ¼ntÃ¼le
                            </button>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-6">
                  <button 
                    onClick={() => setPage('pos')} 
                    className="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-8 rounded-xl hover:shadow-2xl transition transform hover:scale-105"
                  >
                    <p className="text-5xl mb-3">ğŸ›’</p>
                    <p className="text-xl font-bold">HÄ±zlÄ± SatÄ±ÅŸ (POS)</p>
                    <p className="text-sm mt-2 opacity-80">AnÄ±nda fatura ve tahsilat</p>
                  </button>
                  
                  <button 
                    onClick={generateBarcodeLabels} 
                    className="bg-gradient-to-r from-green-500 to-emerald-600 text-white p-8 rounded-xl hover:shadow-2xl transition transform hover:scale-105"
                  >
                    <p className="text-5xl mb-3">ğŸ·ï¸</p>
                    <p className="text-xl font-bold">Barkod Etiketleri</p>
                    <p className="text-sm mt-2 opacity-80">Toplu barkod yazdÄ±r</p>
                  </button>
                  
                  <button 
                    onClick={startScanner} 
                    className="bg-gradient-to-r from-pink-500 to-rose-600 text-white p-8 rounded-xl hover:shadow-2xl transition transform hover:scale-105"
                  >
                    <p className="text-5xl mb-3">ğŸ“¸</p>
                    <p className="text-xl font-bold">Kamera ile Tara</p>
                    <p className="text-sm mt-2 opacity-80">Barkod/QR kod okut</p>
                  </button>
                </div>
              </div>
            )}

            {page === 'analytics' && analyticsData && (
              <div className="space-y-6 fade-in">
                <h1 className="text-3xl font-bold">ğŸ“ˆ SatÄ±ÅŸ Analizi ve Raporlar</h1>
                
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  <div className={darkMode ? 'bg-gray-800 rounded-xl shadow-lg p-6' : 'bg-white rounded-xl shadow-lg p-6'}>
                    <h3 className="text-xl font-bold mb-4">ğŸ† En Ã‡ok Satan ÃœrÃ¼nler</h3>
                    {analyticsData.topProducts.length > 0 ? (
                      <div className="space-y-3">
                        {analyticsData.topProducts.map(([name, count], i) => (
                          <div key={i} className="flex justify-between items-center p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg hover:shadow-md transition">
                            <div className="flex items-center gap-3">
                              <span className="text-3xl">
                                {i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : 'ğŸ…'}
                              </span>
                              <div>
                                <p className="font-bold text-lg text-black">{name}</p>
                                <p className="text-sm text-gray-600">{count} adet satÄ±ldÄ±</p>
                              </div>
                            </div>
                            <div className="text-right">
                              <p className="text-2xl font-bold text-blue-600">#{i + 1}</p>
                            </div>
                          </div>
                        ))}
                      </div>
                    ) : (
                      <p className="text-center text-gray-500 py-8">HenÃ¼z satÄ±ÅŸ verisi yok</p>
                    )}
                  </div>

                  <div className={darkMode ? 'bg-gray-800 rounded-xl shadow-lg p-6' : 'bg-white rounded-xl shadow-lg p-6'}>
                    <h3 className="text-xl font-bold mb-4">ğŸ“Š Kategori BazlÄ± Stok DeÄŸeri</h3>
                    {Object.keys(analyticsData.categorySales).length > 0 ? (
                      <div className="space-y-3">
                        {Object.entries(analyticsData.categorySales)
                          .sort((a, b) => b[1] - a[1])
                          .map(([cat, total]) => (
                            <div key={cat} className="flex justify-between items-center p-4 bg-purple-50 rounded-lg hover:shadow-md transition">
                              <p className="font-semibold text-black">{cat}</p>
                              <p className="font-bold text-purple-600 text-lg">{total.toFixed(2)} TL</p>
                            </div>
                          ))}
                      </div>
                    ) : (
                      <p className="text-center text-gray-500 py-8">Kategori verisi yok</p>
                    )}
                  </div>
                </div>
              </div>
            )}

            {page === 'finance' && (
              <div className="space-y-6 fade-in">
                <div className="flex justify-between items-center flex-wrap gap-3">
                  <h1 className="text-3xl font-bold">ğŸ’° Gelir/Gider YÃ¶netimi</h1>
                  <button 
                    onClick={() => setModal('addTransaction')} 
                    className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition"
                  >
                    + Yeni Ä°ÅŸlem
                  </button>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                  <div className="bg-green-50 border-2 border-green-300 rounded-xl p-6 hover:shadow-lg transition">
                    <p className="text-sm text-green-700 font-semibold mb-2">ğŸ’µ Toplam Gelir</p>
                    <p className="text-4xl font-bold text-green-800">
                      {dashboardData.totalIncome.toFixed(2)} â‚º
                    </p>
                  </div>
                  
                  <div className="bg-red-50 border-2 border-red-300 rounded-xl p-6 hover:shadow-lg transition">
                    <p className="text-sm text-red-700 font-semibold mb-2">ğŸ’¸ Toplam Gider</p>
                    <p className="text-4xl font-bold text-red-800">
                      {dashboardData.totalExpense.toFixed(2)} â‚º
                    </p>
                  </div>
                  
                  <div className="bg-blue-50 border-2 border-blue-300 rounded-xl p-6 hover:shadow-lg transition">
                    <p className="text-sm text-blue-700 font-semibold mb-2">ğŸ“Š Net KÃ¢r</p>
                    <p className="text-4xl font-bold text-blue-800">
                      {dashboardData.profit.toFixed(2)} â‚º
                    </p>
                  </div>
                </div>

                <div className={darkMode ? 'bg-gray-800 rounded-xl shadow-lg p-6' : 'bg-white rounded-xl shadow-lg p-6'}>
                  <h3 className="text-xl font-bold mb-4">ğŸ“‹ Son Ä°ÅŸlemler</h3>
                  {transactions.length > 0 ? (
                    <div className="space-y-3">
                      {transactions.slice(0, 20).map(tr => (
                        <div 
                          key={tr.id} 
                          className={`p-4 rounded-lg flex justify-between items-center hover:shadow-md transition ${
                            tr.type === 'income' ? 'bg-green-50 border-l-4 border-green-500' : 'bg-red-50 border-l-4 border-red-500'
                          }`}
                        >
                          <div className="flex-1">
                            <div className="flex items-center gap-2 mb-1">
                              <span className="text-xl">{tr.type === 'income' ? 'ğŸ’°' : 'ğŸ’¸'}</span>
                              <p className="font-semibold text-black">{tr.category}</p>
                            </div>
                            {tr.description && (
                              <p className="text-sm text-gray-600 ml-7">{tr.description}</p>
                            )}
                            <p className="text-xs text-gray-500 ml-7">
                              {new Date(tr.date).toLocaleDateString('tr-TR')}
                            </p>
                          </div>
                          <p className={`text-2xl font-bold ${
                            tr.type === 'income' ? 'text-green-600' : 'text-red-600'
                          }`}>
                            {tr.type === 'income' ? '+' : '-'}{parseFloat(tr.amount).toFixed(2)} â‚º
                          </p>
                        </div>
                      ))}
                    </div>
                  ) : (
                    <p className="text-center text-gray-500 py-8">HenÃ¼z iÅŸlem yok</p>
                  )}
                </div>
              </div>
            )}

            {page === 'suppliers' && (
              <div className="space-y-6 fade-in">
                <div className={darkMode ? 'bg-gray-800 rounded-xl shadow-lg p-6' : 'bg-white rounded-xl shadow-lg p-6'}>
                  <div className="flex justify-between items-center mb-6">
                    <h2 className="text-2xl font-bold">ğŸ­ TedarikÃ§i YÃ¶netimi</h2>
                    <button 
                      onClick={() => setModal('addSupplier')} 
                      className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition"
                    >
                      + Yeni TedarikÃ§i
                    </button>
                  </div>
                  
                  {suppliers.length > 0 ? (
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                      {suppliers.map(s => (
                        <div 
                          key={s.id} 
                          className="border-2 rounded-lg p-5 hover:border-blue-500 hover:shadow-lg transition"
                        >
                          <h3 className="font-bold text-lg mb-3">{s.name}</h3>
                          <div className="space-y-2 text-sm">
                            {s.phone && (
                              <p className="text-gray-600 flex items-center gap-2">
                                <span>ğŸ“</span> {s.phone}
                              </p>
                            )}
                            {s.email && (
                              <p className="text-gray-600 flex items-center gap-2">
                                <span>ğŸ“§</span> {s.email}
                              </p>
                            )}
                            {s.address && (
                              <p className="text-gray-600 flex items-center gap-2">
                                <span>ğŸ“</span> {s.address}
                              </p>
                            )}
                            {s.notes && (
                              <p className="text-gray-500 italic mt-2">
                                ğŸ’­ {s.notes}
                              </p>
                            )}
                          </div>
                        </div>
                      ))}
                    </div>
                  ) : (
                    <div className="text-center py-12">
                      <p className="text-gray-500 text-lg mb-4">HenÃ¼z tedarikÃ§i eklenmemiÅŸ</p>
                      <button 
                        onClick={() => setModal('addSupplier')}
                        className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition"
                      >
                        Ä°lk TedarikÃ§iyi Ekle
                      </button>
                    </div>
                  )}
                </div>
              </div>
            )}

            {page === 'pos' && (
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 fade-in">
                <div className={darkMode ? 'bg-gray-800 rounded-xl shadow-lg p-6' : 'bg-white rounded-xl shadow-lg p-6'}>
                  <h2 className="text-2xl font-bold mb-4">ğŸ›’ HÄ±zlÄ± SatÄ±ÅŸ (POS)</h2>
                  
                  <div className="flex gap-3 mb-4">
                    <input 
                      type="text" 
                      placeholder="ğŸ” Barkod girin veya tara..." 
                      value={barcodeInput} 
                      onChange={e => setBarcodeInput(e.target.value)} 
                      onKeyPress={e => e.key === 'Enter' && searchByBarcode(barcodeInput)} 
                      className="flex-1 px-4 py-3 border-2 rounded-lg text-black focus:border-blue-500 outline-none"
                      autoFocus 
                    />
                    <button 
                      onClick={startScanner} 
                      className="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg transition"
                    >
                      ğŸ“·
                    </button>
                  </div>
                  
                  <input 
                    type="text" 
                    placeholder="ğŸ” ÃœrÃ¼n ara..." 
                    value={search} 
                    onChange={e => setSearch(e.target.value)} 
                    className="w-full px-4 py-3 border-2 rounded-lg mb-4 text-black focus:border-blue-500 outline-none"
                  />
                  
                  <div className="max-h-96 overflow-y-auto space-y-2">
                    {filtered.slice(0, 15).map(p => (
                      <div 
                        key={p.id} 
                        onClick={() => addToCart(p)} 
                        className={`border-2 rounded-lg p-3 cursor-pointer transition ${
                          p.current_stock > 0 
                            ? 'hover:border-blue-500 hover:bg-blue-50' 
                            : 'opacity-50 cursor-not-allowed'
                        }`}
                      >
                        <div className="flex justify-between items-center">
                          <div className="flex-1">
                            <p className="font-bold text-black">{p.name}</p>
                            <div className="flex gap-3 text-sm text-gray-600">
                              <span>ğŸ’µ {p.price} TL</span>
                              <span className={p.current_stock > 10 ? 'text-green-600' : 'text-orange-600'}>
                                ğŸ“¦ {p.current_stock} adet
                              </span>
                            </div>
                          </div>
                          <button 
                            className={`px-4 py-2 rounded-lg font-bold transition ${
                              p.current_stock > 0 
                                ? 'bg-blue-600 hover:bg-blue-700 text-white' 
                                : 'bg-gray-300 text-gray-500'
                            }`}
                            disabled={p.current_stock <= 0}
                          >
                            +
                          </button>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>

                <div className={darkMode ? 'bg-gray-800 rounded-xl shadow-lg p-6' : 'bg-white rounded-xl shadow-lg p-6'}>
                  <h3 className="text-xl font-bold mb-4">ğŸ›ï¸ Sepet</h3>
                  
                  {!posCart.length ? (
                    <div className="text-center py-16">
                      <p className="text-6xl mb-4">ğŸ›’</p>
                      <p className="text-gray-500 text-lg">Sepet boÅŸ</p>
                      <p className="text-gray-400 text-sm mt-2">ÃœrÃ¼n eklemek iÃ§in soldan seÃ§in</p>
                    </div>
                  ) : (
                    <>
                      <div className="max-h-80 overflow-y-auto mb-4 space-y-2">
                        {posCart.map(item => (
                          <div 
                            key={item.id} 
                            className="border-2 rounded-lg p-3 hover:border-blue-400 transition"
                          >
                            <div className="flex justify-between items-start mb-3">
                              <p className="font-semibold flex-1 text-black">{item.name}</p>
                              <button 
                                onClick={() => removeFromCart(item.id)} 
                                className="text-red-600 hover:text-red-800 font-bold ml-2"
                              >
                                ğŸ—‘ï¸
                              </button>
                            </div>
                            
                            <div className="flex justify-between items-center">
                              <div className="flex gap-2 items-center">
                                <button 
                                  onClick={() => updateCartQuantity(item.id, item.quantity - 1)} 
                                  className="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded text-black font-bold transition"
                                >
                                  -
                                </button>
                                <span className="w-12 text-center font-bold text-lg">{item.quantity}</span>
                                <button 
                                  onClick={() => updateCartQuantity(item.id, item.quantity + 1)} 
                                  className="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded text-black font-bold transition"
                                >
                                  +
                                </button>
                              </div>
                              
                              <div className="text-right">
                                <p className="text-xs text-gray-500">{item.price} TL Ã— {item.quantity}</p>
                                <p className="font-bold text-green-600 text-lg">
                                  {item.total.toFixed(2)} TL
                                </p>
                              </div>
                            </div>
                          </div>
                        ))}
                      </div>
                      
                      <div className="border-t-2 pt-4 space-y-4">
                        <div className="flex justify-between items-center bg-gray-50 p-4 rounded-lg">
                          <p className="text-xl font-bold">TOPLAM:</p>
                          <p className="text-3xl font-bold text-green-600">
                            {posCart.reduce((s, i) => s + i.total, 0).toFixed(2)} TL
                          </p>
                        </div>
                        
                        <select 
                          value={posCustomer?.id || ''} 
                          onChange={e => setPosCustomer(customers.find(c => c.id === parseInt(e.target.value)) || null)} 
                          className="w-full px-4 py-3 border-2 rounded-lg text-black focus:border-blue-500 outline-none"
                        >
                          <option value="">ğŸ‘¤ MÃ¼ÅŸteri SeÃ§ (Opsiyonel)</option>
                          {customers.map(c => (
                            <option key={c.id} value={c.id}>{c.name} - {c.phone}</option>
                          ))}
                        </select>
                        
                        <select
                          value={posPaymentMethod}
                          onChange={e => setPosPaymentMethod(e.target.value)}
                          className="w-full px-4 py-3 border-2 rounded-lg text-black focus:border-blue-500 outline-none"
                        >
                          <option value="cash">ğŸ’µ Nakit</option>
                          <option value="card">ğŸ’³ Kredi/Banka KartÄ±</option>
                          <option value="transfer">ğŸ¦ Havale/EFT</option>
                        </select>
                        
                        <button 
                          onClick={completePOSSale} 
                          className="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white py-4 rounded-lg font-bold text-xl transition shadow-lg"
                        >
                          âœ… SatÄ±ÅŸÄ± Tamamla
                        </button>
                      </div>
                    </>
                  )}
                </div>
              </div>
            )}

            {page === 'products' && (
              <div className="space-y-6 fade-in">
                {currentUser.role === 'admin' && (
                  <div className="bg-gradient-to-r from-green-600 to-emerald-600 rounded-xl p-6 text-white shadow-lg">
                    <h3 className="text-xl font-bold mb-4">ğŸ“Š Excel Ä°Ã§e/DÄ±ÅŸa AktarÄ±m</h3>
                    <div className="flex gap-3 flex-wrap">
                      <input 
                        ref={fileInputRef} 
                        type="file" 
                        accept=".xlsx,.xls" 
                        onChange={handleExcelImport} 
                        className="hidden" 
                        id="excel" 
                      />
                      <label 
                        htmlFor="excel" 
                        className="bg-white text-green-600 px-6 py-3 rounded-lg cursor-pointer font-semibold inline-block hover:bg-gray-100 transition"
                      >
                        ğŸ“ Excel Ä°Ã§e Aktar
                      </label>
                      <button
                        onClick={exportToExcel}
                        className="bg-white text-green-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition"
                      >
                        ğŸ“¤ Excel Ä°ndir
                      </button>
                    </div>
                    <p className="text-sm mt-3 opacity-90">
                      Excel'de ÅŸu sÃ¼tunlar olmalÄ±: ÃœrÃ¼n AdÄ±, Barkod, Fiyat, Stok, Kategori
                    </p>
                  </div>
                )}
                
                <div className={darkMode ? 'bg-gray-800 rounded-xl shadow-lg p-6' : 'bg-white rounded-xl shadow-lg p-6'}>
                  <div className="flex flex-wrap gap-3 mb-4">
                    <input 
                      type="text" 
                      placeholder="ğŸ” ÃœrÃ¼n, barkod veya kategori ara..." 
                      value={search} 
                      onChange={e => setSearch(e.target.value)} 
                      className="flex-1 min-w-[200px] px-4 py-3 border-2 rounded-lg text-black focus:border-blue-500 outline-none"
                    />
                    
                    <select
                      value={filterCategory}
                      onChange={e => setFilterCategory(e.target.value)}
                      className="px-4 py-3 border-2 rounded-lg text-black focus:border-blue-500 outline-none"
                    >
                      <option value="all">ğŸ“ TÃ¼m Kategoriler</option>
                      {categories.map(cat => (
                        <option key={cat} value={cat}>{cat}</option>
                      ))}
                    </select>
                    
                    <select
                      value={sortBy}
                      onChange={e => setSortBy(e.target.value)}
                      className="px-4 py-3 border-2 rounded-lg text-black focus:border-blue-500 outline-none"
                    >
                      <option value="name">ğŸ”¤ Ä°sme GÃ¶re</option>
                      <option value="price">ğŸ’° Fiyata GÃ¶re</option>
                      <option value="stock">ğŸ“¦ Stoka GÃ¶re</option>
                    </select>
                  </div>
                </div>
                
                {filtered.length > 0 ? (
                  <div className={darkMode ? 'bg-gray-800 rounded-xl shadow-lg p-6' : 'bg-white rounded-xl shadow-lg p-6'}>
                    <h3 className="text-xl font-bold mb-4">
                      ğŸ“¦ ÃœrÃ¼nler ({filtered.length})
                    </h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                      {filtered.map(p => (
                        <div 
                          key={p.id} 
                          onClick={() => { setSelectedProduct(p); setModal('detail'); }} 
                          className="border-2 rounded-lg p-4 cursor-pointer hover:border-blue-500 hover:shadow-lg transition"
                        >
                          <div className="flex justify-between items-start mb-2">
                            <h4 className="font-bold text-lg flex-1">{p.name}</h4>
                            {p.current_stock <= (p.min_stock || 5) && (
                              <span className="bg-red-500 text-white text-xs px-2 py-1 rounded-full font-semibold ml-2">
                                âš ï¸
                              </span>
                            )}
                          </div>
                          
                          <div className="space-y-1 text-sm">
                            <p className="text-gray-600">
                              ğŸ’µ <span className="font-semibold">{p.price} TL</span>
                            </p>
                            <p className={`${p.current_stock > 10 ? 'text-green-600' : 'text-orange-600'} font-semibold`}>
                              ğŸ“¦ Stok: {p.current_stock}
                            </p>
                            {p.category && (
                              <p className="text-gray-500">
                                ğŸ“ {p.category}
                              </p>
                            )}
                            {p.barcode && (
                              <p className="text-gray-500 font-mono text-xs">
                                ğŸ”– {p.barcode}
                              </p>
                            )}
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                ) : (
                  <div className="text-center py-16">
                    <p className="text-6xl mb-4">ğŸ”</p>
                    <p className="text-gray-500 text-lg">ÃœrÃ¼n bulunamadÄ±</p>
                  </div>
                )}
              </div>
            )}

            {page === 'customers' && (
              <div className="space-y-6 fade-in">
                <div className={darkMode ? 'bg-gray-800 rounded-xl shadow-lg p-6' : 'bg-white rounded-xl shadow-lg p-6'}>
                  <div className="flex justify-between items-center mb-6">
                    <h2 className="text-2xl font-bold">ğŸ‘¥ MÃ¼ÅŸteri YÃ¶netimi</h2>
                    <button 
                      onClick={() => setModal('addCustomer')} 
                      className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition"
                    >
                      + Yeni MÃ¼ÅŸteri
                    </button>
                  </div>
                  
                  {customers.length > 0 ? (
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                      {customers.map(c => (
                        <div 
                          key={c.id} 
                          className="border-2 rounded-lg p-5 hover:border-blue-500 hover:shadow-lg transition"
                        >
                          <h3 className="font-bold text-lg mb-3">ğŸ‘¤ {c.name}</h3>
                          <div className="space-y-2 text-sm">
                            <p className="text-gray-600 flex items-center gap-2">
                              <span>ğŸ“</span> {c.phone}
                            </p>
                            {c.email && (
                              <p className="text-gray-600 flex items-center gap-2">
                                <span>ğŸ“§</span> {c.email}
                              </p>
                            )}
                            {c.address && (
                              <p className="text-gray-600 flex items-center gap-2">
                                <span>ğŸ“</span> {c.address}
                              </p>
                            )}
                          </div>
                        </div>
                      ))}
                    </div>
                  ) : (
                    <div className="text-center py-12">
                      <p className="text-gray-500 text-lg mb-4">HenÃ¼z mÃ¼ÅŸteri eklenmemiÅŸ</p>
                      <button 
                        onClick={() => setModal('addCustomer')}
                        className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition"
                      >
                        Ä°lk MÃ¼ÅŸteriyi Ekle
                      </button>
                    </div>
                  )}
                </div>
              </div>
            )}

            {page === 'invoices' && (
              <div className="space-y-6 fade-in">
                <div className={darkMode ? 'bg-gray-800 rounded-xl shadow-lg p-6' : 'bg-white rounded-xl shadow-lg p-6'}>
                  <h2 className="text-2xl font-bold mb-6">ğŸ“„ Fatura YÃ¶netimi</h2>
                  
                  {invoices.length > 0 ? (
                    <div className="space-y-4">
                      {invoices.map(inv => (
                        <div 
                          key={inv.id} 
                          className="border-2 rounded-lg p-5 hover:border-blue-500 hover:shadow-lg transition"
                        >
                          <div className="flex justify-between items-start mb-3 flex-wrap gap-3">
                            <div>
                              <h3 className="text-xl font-bold">{inv.invoice_number}</h3>
                              <p className="text-sm text-gray-500">
                                ğŸ“… {new Date(inv.invoice_date).toLocaleDateString('tr-TR')}
                              </p>
                              {inv.customer_id && (
                                <p className="text-sm text-gray-600 mt-1">
                                  ğŸ‘¤ {customers.find(c => c.id === inv.customer_id)?.name || 'MÃ¼ÅŸteri'}
                                </p>
                              )}
                            </div>
                            
                            <div className="flex gap-2">
                              <button 
                                onClick={() => generatePDFInvoice(inv)} 
                                className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-semibold transition"
                              >
                                ğŸ“„ PDF Ä°ndir
                              </button>
                            </div>
                          </div>
                          
                          <div className="bg-green-50 border-2 border-green-200 rounded-lg p-4">
                            <div className="flex justify-between items-center">
                              <div>
                                <p className="text-sm text-green-700">Toplam Tutar</p>
                                <p className="text-3xl font-bold text-green-800">
                                  {(inv.total_amount || 0).toFixed(2)} TL
                                </p>
                              </div>
                              <div className="text-right text-sm text-gray-600">
                                <p>ğŸ“¦ {inv.product_count || 0} Ã¼rÃ¼n</p>
                                {inv.payment_method && (
                                  <p className="mt-1">
                                    {inv.payment_method === 'cash' ? 'ğŸ’µ Nakit' : 
                                     inv.payment_method === 'card' ? 'ğŸ’³ Kart' : 'ğŸ¦ Havale'}
                                  </p>
                                )}
                              </div>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  ) : (
                    <div className="text-center py-12">
                      <p className="text-gray-500 text-lg mb-4">HenÃ¼z fatura yok</p>
                      <button 
                        onClick={() => setPage('pos')}
                        className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition"
                      >
                        Ä°lk SatÄ±ÅŸÄ± Yap
                      </button>
                    </div>
                  )}
                </div>
              </div>
            )}

            {page === 'settings' && (
              <div className="space-y-6 fade-in">
                <h1 className="text-3xl font-bold">âš™ï¸ Sistem AyarlarÄ±</h1>
                
                {/* Supabase AyarlarÄ± */}
                <div className={darkMode ? 'bg-gray-800 rounded-xl shadow-lg p-6' : 'bg-white rounded-xl shadow-lg p-6'}>
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-2xl font-bold">ğŸ”— Supabase VeritabanÄ± BaÄŸlantÄ±sÄ±</h2>
                    <div className="flex items-center gap-2">
                      {isSupabaseConnected ? (
                        <span className="bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-semibold">
                          âœ… BaÄŸlÄ±
                        </span>
                      ) : (
                        <span className="bg-red-100 text-red-700 px-3 py-1 rounded-full text-sm font-semibold">
                          âŒ BaÄŸlÄ± DeÄŸil
                        </span>
                      )}
                    </div>
                  </div>
                  
                  <div className="space-y-4">
                    <button
                      type="button"
                      onClick={(e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        setModal('supabaseSettings');
                      }}
                      className="w-full bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition cursor-pointer"
                    >
                      âš™ï¸ Supabase AyarlarÄ±nÄ± DÃ¼zenle
                    </button>
                    
                    <button
                      type="button"
                      onClick={(e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        testSupabaseConnection();
                      }}
                      className="w-full bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold transition cursor-pointer"
                    >
                      ğŸ” BaÄŸlantÄ±yÄ± Test Et
                    </button>
                  </div>
                  
                  <div className="mt-6 p-4 bg-blue-50 rounded-lg">
                    <p className="text-sm text-gray-700 mb-2"><strong>ğŸ“š Supabase Kurulum AdÄ±mlarÄ±:</strong></p>
                    <ol className="text-sm text-gray-600 space-y-2 list-decimal list-inside">
                      <li><a href="https://supabase.com" target="_blank" className="text-blue-600 hover:underline">supabase.com</a> adresine gidin ve Ã¼cretsiz hesap oluÅŸturun</li>
                      <li>Dashboard'da "New Project" butonuna tÄ±klayÄ±n</li>
                      <li>Proje adÄ± ve ÅŸifre belirleyin</li>
                      <li>Sol menÃ¼den "Settings" â†’ "API" sayfasÄ±na gidin</li>
                      <li>"Project URL" ve "anon public" key'i kopyalayÄ±p yukarÄ±daki butona tÄ±klayarak yapÄ±ÅŸtÄ±rÄ±n</li>
                      <li>"SQL Editor" bÃ¶lÃ¼mÃ¼nden gerekli tablolarÄ± oluÅŸturun</li>
                    </ol>
                  </div>
                  
                  <div className="mt-4 p-4 bg-purple-50 rounded-lg">
                    <p className="text-sm text-gray-700 mb-2"><strong>ğŸ—„ï¸ Gerekli Tablolar:</strong></p>
                    <div className="text-xs text-gray-600 space-y-1">
                      <p>â€¢ users (id, username, password, full_name, role)</p>
                      <p>â€¢ products (id, name, barcode, price, current_stock, min_stock, category)</p>
                      <p>â€¢ customers (id, name, phone, email, address)</p>
                      <p>â€¢ suppliers (id, name, phone, email, address, notes)</p>
                      <p>â€¢ invoices (id, invoice_number, invoice_date, depot, total_amount, product_count, customer_id, payment_method)</p>
                      <p>â€¢ invoice_items (id, invoice_id, product_id, quantity, unit_price, total_price)</p>
                      <p>â€¢ transactions (id, type, category, amount, description, date, user_id)</p>
                      <p>â€¢ stock_movements (id, product_id, movement_type, quantity, user_id, notes)</p>
                      <p>â€¢ stock_alerts (id, product_id, message, is_read)</p>
                    </div>
                  </div>
                </div>
                
                {/* Genel Ayarlar */}
                <div className={darkMode ? 'bg-gray-800 rounded-xl shadow-lg p-6' : 'bg-white rounded-xl shadow-lg p-6'}>
                  <h2 className="text-2xl font-bold mb-4">ğŸ¨ Genel Ayarlar</h2>
                  
                  <div className="space-y-4">
                    <div className="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                      <div>
                        <p className="font-semibold">KaranlÄ±k Mod</p>
                        <p className="text-sm text-gray-600">ArayÃ¼z temasÄ±nÄ± deÄŸiÅŸtir</p>
                      </div>
                      <button
                        onClick={() => setDarkMode(!darkMode)}
                        className={`px-4 py-2 rounded-lg font-semibold transition ${
                          darkMode ? 'bg-yellow-500 text-white' : 'bg-gray-700 text-white'
                        }`}
                      >
                        {darkMode ? 'â˜€ï¸ AÃ§Ä±k' : 'ğŸŒ™ Koyu'}
                      </button>
                    </div>
                    
                    <div className="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                      <div>
                        <p className="font-semibold">Yedekleme</p>
                        <p className="text-sm text-gray-600">TÃ¼m verileri yedekle</p>
                      </div>
                      <button
                        onClick={autoBackup}
                        className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold transition"
                      >
                        ğŸ’¾ Yedek Al
                      </button>
                    </div>
                    
                    <div className="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                      <div>
                        <p className="font-semibold">Åifre DeÄŸiÅŸtir</p>
                        <p className="text-sm text-gray-600">GiriÅŸ ÅŸifrenizi gÃ¼ncelleyin</p>
                      </div>
                      <button
                        onClick={() => setModal('changePassword')}
                        className="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold transition"
                      >
                        ğŸ” DeÄŸiÅŸtir
                      </button>
                    </div>
                  </div>
                </div>
                
                {/* Sistem Bilgileri */}
                <div className={darkMode ? 'bg-gray-800 rounded-xl shadow-lg p-6' : 'bg-white rounded-xl shadow-lg p-6'}>
                  <h2 className="text-2xl font-bold mb-4">â„¹ï¸ Sistem Bilgileri</h2>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="p-4 bg-blue-50 rounded-lg">
                      <p className="text-sm text-gray-600">SÃ¼rÃ¼m</p>
                      <p className="text-lg font-bold text-blue-600">v2.0.0</p>
                    </div>
                    
                    <div className="p-4 bg-green-50 rounded-lg">
                      <p className="text-sm text-gray-600">KullanÄ±cÄ±</p>
                      <p className="text-lg font-bold text-green-600">{currentUser.full_name}</p>
                    </div>
                    
                    <div className="p-4 bg-purple-50 rounded-lg">
                      <p className="text-sm text-gray-600">Rol</p>
                      <p className="text-lg font-bold text-purple-600">{currentUser.role === 'admin' ? 'ğŸ‘‘ Admin' : 'ğŸ‘¤ KullanÄ±cÄ±'}</p>
                    </div>
                    
                    <div className="p-4 bg-orange-50 rounded-lg">
                      <p className="text-sm text-gray-600">Toplam ÃœrÃ¼n</p>
                      <p className="text-lg font-bold text-orange-600">{products.length}</p>
                    </div>
                  </div>
                </div>
              </div>
            )}
          </div>

          {/* MODALS - TÃ¼m modaller burada */}
          {modal === 'supabaseSettings' && currentUser && (
            <div 
              className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[9999] modal-enter"
              onClick={(e) => {
                if (e.target === e.currentTarget) {
                  setModal('');
                }
              }}
            >
              <div className="bg-white rounded-xl p-6 w-full max-w-2xl text-black max-h-[90vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
                <h2 className="text-2xl font-bold mb-4">ğŸ”— Supabase VeritabanÄ± AyarlarÄ±</h2>
                
                <div className="space-y-4 mb-6">
                  <div>
                    <label className="block text-sm font-semibold mb-2">Supabase Project URL *</label>
                    <input
                      type="text"
                      placeholder="https://xxxxx.supabase.co"
                      value={supabaseConfig.url}
                      onChange={e => setSupabaseConfig({...supabaseConfig, url: e.target.value})}
                      className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 outline-none"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold mb-2">Anon Public Key *</label>
                    <textarea
                      placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                      value={supabaseConfig.key}
                      onChange={e => setSupabaseConfig({...supabaseConfig, key: e.target.value})}
                      className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 outline-none font-mono text-xs"
                      rows={5}
                    ></textarea>
                  </div>
                </div>
                
                <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-4 mb-6">
                  <p className="text-sm font-semibold text-blue-900 mb-2">ğŸ“‹ NasÄ±l Bulabilirim?</p>
                  <ol className="text-xs text-blue-800 space-y-1 list-decimal list-inside">
                    <li>supabase.com adresine gidip giriÅŸ yapÄ±n</li>
                    <li>Projenizi seÃ§in</li>
                    <li>Sol menÃ¼den "Settings" â†’ "API" sayfasÄ±na gidin</li>
                    <li>"Project URL" ve "anon public" key'i kopyalayÄ±n</li>
                    <li>YukarÄ±daki alanlara yapÄ±ÅŸtÄ±rÄ±n</li>
                  </ol>
                </div>
                
                <div className="flex gap-3">
                  <button
                    type="button"
                    onClick={(e) => {
                      e.preventDefault();
                      e.stopPropagation();
                      saveSupabaseConfig();
                    }}
                    className="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold transition"
                  >
                    âœ… Kaydet ve BaÄŸlan
                  </button>
                  <button
                    type="button"
                    onClick={(e) => {
                      e.preventDefault();
                      e.stopPropagation();
                      setModal('');
                    }}
                    className="flex-1 bg-gray-200 hover:bg-gray-300 py-3 rounded-lg font-semibold transition"
                  >
                    âŒ Ä°ptal
                  </button>
                </div>
              </div>
            </div>
          )}

          {modal === 'scanner' && (
            <div className="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4 z-50 modal-enter">
              <div className="bg-white rounded-xl p-6 w-full max-w-md">
                <h2 className="text-2xl font-bold mb-4 text-center text-black">ğŸ“¸ Barkod Tara</h2>
                <div id="reader" ref={scannerRef} className="mb-4 rounded-lg overflow-hidden"></div>
                <button 
                  onClick={stopScanner} 
                  className="w-full bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg font-semibold transition"
                >
                  âŒ Kapat
                </button>
              </div>
            </div>
          )}

          {modal === 'detail' && selectedProduct && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 modal-enter">
              <div className="bg-white rounded-xl p-6 w-full max-w-md text-black">
                <h2 className="text-2xl font-bold mb-4">{selectedProduct.name}</h2>
                
                <div className="space-y-3 mb-6 bg-gray-50 p-4 rounded-lg">
                  <p className="flex justify-between">
                    <strong>ğŸ’µ Fiyat:</strong> 
                    <span>{selectedProduct.price} TL</span>
                  </p>
                  <p className="flex justify-between">
                    <strong>ğŸ“¦ Mevcut Stok:</strong> 
                    <span className={selectedProduct.current_stock > 10 ? 'text-green-600' : 'text-orange-600'}>
                      {selectedProduct.current_stock}
                    </span>
                  </p>
                  <p className="flex justify-between">
                    <strong>âš ï¸ Minimum Stok:</strong> 
                    <span>{selectedProduct.min_stock || 5}</span>
                  </p>
                  {selectedProduct.category && (
                    <p className="flex justify-between">
                      <strong>ğŸ“ Kategori:</strong> 
                      <span>{selectedProduct.category}</span>
                    </p>
                  )}
                  {selectedProduct.barcode && (
                    <p className="flex justify-between">
                      <strong>ğŸ”– Barkod:</strong> 
                      <span className="font-mono text-sm">{selectedProduct.barcode}</span>
                    </p>
                  )}
                </div>
                
                {currentUser.role === 'admin' && (
                  <div className="space-y-3 mb-4">
                    <div className="flex gap-3">
                      <button 
                        onClick={() => { 
                          const q = prompt('KaÃ§ adet giriÅŸ yapÄ±lacak?'); 
                          if (q && !isNaN(q) && parseInt(q) > 0) {
                            addStockMovement('in', parseInt(q)); 
                          }
                        }} 
                        className="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition"
                      >
                        ğŸ“¥ Stok GiriÅŸi
                      </button>
                      <button 
                        onClick={() => { 
                          const q = prompt('KaÃ§ adet Ã§Ä±kÄ±ÅŸ yapÄ±lacak?'); 
                          if (q && !isNaN(q) && parseInt(q) > 0) {
                            addStockMovement('out', parseInt(q)); 
                          }
                        }} 
                        className="flex-1 bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg font-semibold transition"
                      >
                        ğŸ“¤ Stok Ã‡Ä±kÄ±ÅŸÄ±
                      </button>
                    </div>
                    
                    <button
                      onClick={() => deleteProduct(selectedProduct.id)}
                      className="w-full bg-gray-700 hover:bg-gray-800 text-white py-3 rounded-lg font-semibold transition"
                    >
                      ğŸ—‘ï¸ ÃœrÃ¼nÃ¼ Sil
                    </button>
                  </div>
                )}
                
                <button 
                  onClick={() => setModal('')} 
                  className="w-full bg-gray-200 hover:bg-gray-300 py-3 rounded-lg font-semibold transition"
                >
                  Kapat
                </button>
              </div>
            </div>
          )}

          {modal === 'addCustomer' && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 modal-enter">
              <div className="bg-white rounded-xl p-6 w-full max-w-md text-black">
                <h2 className="text-2xl font-bold mb-4">ğŸ‘¤ Yeni MÃ¼ÅŸteri Ekle</h2>
                
                <div className="space-y-3">
                  <input 
                    type="text" 
                    placeholder="Ad Soyad *" 
                    value={newCustomer.name} 
                    onChange={e => setNewCustomer({...newCustomer, name: e.target.value})} 
                    className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 outline-none"
                  />
                  
                  <input 
                    type="tel" 
                    placeholder="Telefon *" 
                    value={newCustomer.phone} 
                    onChange={e => setNewCustomer({...newCustomer, phone: e.target.value})} 
                    className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 outline-none"
                  />
                  
                  <input 
                    type="email" 
                    placeholder="E-posta" 
                    value={newCustomer.email} 
                    onChange={e => setNewCustomer({...newCustomer, email: e.target.value})} 
                    className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 outline-none"
                  />
                  
                  <textarea 
                    placeholder="Adres" 
                    value={newCustomer.address} 
                    onChange={e => setNewCustomer({...newCustomer, address: e.target.value})} 
                    className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 outline-none"
                    rows={3}
                  ></textarea>
                </div>
                
                <div className="flex gap-3 mt-6">
                  <button 
                    onClick={addCustomer} 
                    className="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold transition"
                  >
                    âœ… Kaydet
                  </button>
                  <button 
                    onClick={() => { 
                      setModal(''); 
                      setNewCustomer({ name: '', phone: '', email: '', address: '' }); 
                    }} 
                    className="flex-1 bg-gray-200 hover:bg-gray-300 py-3 rounded-lg font-semibold transition"
                  >
                    âŒ Ä°ptal
                  </button>
                </div>
              </div>
            </div>
          )}

          {modal === 'addSupplier' && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 modal-enter">
              <div className="bg-white rounded-xl p-6 w-full max-w-md text-black">
                <h2 className="text-2xl font-bold mb-4">ğŸ­ Yeni TedarikÃ§i Ekle</h2>
                
                <div className="space-y-3">
                  <input 
                    type="text" 
                    placeholder="Firma AdÄ± *" 
                    value={newSupplier.name} 
                    onChange={e => setNewSupplier({...newSupplier, name: e.target.value})} 
                    className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 outline-none"
                  />
                  
                  <input 
                    type="tel" 
                    placeholder="Telefon" 
                    value={newSupplier.phone} 
                    onChange={e => setNewSupplier({...newSupplier, phone: e.target.value})} 
                    className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 outline-none"
                  />
                  
                  <input 
                    type="email" 
                    placeholder="E-posta" 
                    value={newSupplier.email} 
                    onChange={e => setNewSupplier({...newSupplier, email: e.target.value})} 
                    className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 outline-none"
                  />
                  
                  <textarea 
                    placeholder="Adres" 
                    value={newSupplier.address} 
                    onChange={e => setNewSupplier({...newSupplier, address: e.target.value})} 
                    className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 outline-none"
                    rows={2}
                  ></textarea>
                  
                  <textarea 
                    placeholder="Notlar" 
                    value={newSupplier.notes} 
                    onChange={e => setNewSupplier({...newSupplier, notes: e.target.value})} 
                    className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 outline-none"
                    rows={2}
                  ></textarea>
                </div>
                
                <div className="flex gap-3 mt-6">
                  <button 
                    onClick={addSupplier} 
                    className="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold transition"
                  >
                    âœ… Kaydet
                  </button>
                  <button 
                    onClick={() => { 
                      setModal(''); 
                      setNewSupplier({ name: '', phone: '', email: '', address: '', notes: '' }); 
                    }} 
                    className="flex-1 bg-gray-200 hover:bg-gray-300 py-3 rounded-lg font-semibold transition"
                  >
                    âŒ Ä°ptal
                  </button>
                </div>
              </div>
            </div>
          )}

          {modal === 'addTransaction' && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 modal-enter">
              <div className="bg-white rounded-xl p-6 w-full max-w-md text-black">
                <h2 className="text-2xl font-bold mb-4">ğŸ’° Yeni Ä°ÅŸlem Ekle</h2>
                
                <div className="space-y-3">
                  <select
                    value={newTransaction.type}
                    onChange={e => setNewTransaction({...newTransaction, type: e.target.value})}
                    className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 outline-none"
                  >
                    <option value="income">ğŸ’µ Gelir</option>
                    <option value="expense">ğŸ’¸ Gider</option>
                  </select>
                  
                  <input 
                    type="text" 
                    placeholder="Kategori (Ã¶r: Kira, MaaÅŸ, SatÄ±ÅŸ) *" 
                    value={newTransaction.category} 
                    onChange={e => setNewTransaction({...newTransaction, category: e.target.value})} 
                    className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 outline-none"
                  />
                  
                  <input 
                    type="number" 
                    step="0.01"
                    placeholder="Tutar *" 
                    value={newTransaction.amount} 
                    onChange={e => setNewTransaction({...newTransaction, amount: e.target.value})} 
                    className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 outline-none"
                  />
                  
                  <textarea 
                    placeholder="AÃ§Ä±klama" 
                    value={newTransaction.description} 
                    onChange={e => setNewTransaction({...newTransaction, description: e.target.value})} 
                    className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 outline-none"
                    rows={3}
                  ></textarea>
                  
                  <input
                    type="date"
                    value={newTransaction.date}
                    onChange={e => setNewTransaction({...newTransaction, date: e.target.value})}
                    className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 outline-none"
                  />
                </div>
                
                <div className="flex gap-3 mt-6">
                  <button 
                    onClick={addTransaction} 
                    className="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold transition"
                  >
                    âœ… Kaydet
                  </button>
                  <button 
                    onClick={() => { 
                      setModal(''); 
                      setNewTransaction({ 
                        type: 'expense', 
                        category: '', 
                        amount: '', 
                        description: '', 
                        date: new Date().toISOString().split('T')[0] 
                      }); 
                    }} 
                    className="flex-1 bg-gray-200 hover:bg-gray-300 py-3 rounded-lg font-semibold transition"
                  >
                    âŒ Ä°ptal
                  </button>
                </div>
              </div>
            </div>
          )}

          {modal === 'changePassword' && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 modal-enter">
              <div className="bg-white rounded-xl p-6 w-full max-w-md text-black">
                <h2 className="text-2xl font-bold mb-4">ğŸ” Åifre DeÄŸiÅŸtir</h2>
                
                <div className="space-y-3">
                  <input 
                    type="password" 
                    placeholder="Mevcut Åifre *" 
                    value={passwordChange.current} 
                    onChange={e => setPasswordChange({...passwordChange, current: e.target.value})} 
                    className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 outline-none"
                  />
                  
                  <input 
                    type="password" 
                    placeholder="Yeni Åifre *" 
                    value={passwordChange.new} 
                    onChange={e => setPasswordChange({...passwordChange, new: e.target.value})} 
                    className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 outline-none"
                  />
                  
                  <input 
                    type="password" 
                    placeholder="Yeni Åifre Tekrar *" 
                    value={passwordChange.confirm} 
                    onChange={e => setPasswordChange({...passwordChange, confirm: e.target.value})} 
                    className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 outline-none"
                  />
                </div>
                
                <p className="text-sm text-gray-500 mt-3">
                  ğŸ’¡ Åifre en az 6 karakter olmalÄ±dÄ±r
                </p>
                
                <div className="flex gap-3 mt-6">
                  <button 
                    onClick={changePassword} 
                    className="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold transition"
                  >
                    âœ… DeÄŸiÅŸtir
                  </button>
                  <button 
                    onClick={() => { 
                      setModal(''); 
                      setPasswordChange({ current: '', new: '', confirm: '' }); 
                    }} 
                    className="flex-1 bg-gray-200 hover:bg-gray-300 py-3 rounded-lg font-semibold transition"
                  >
                    âŒ Ä°ptal
                  </button>
                </div>
              </div>
            </div>
          )}

          {modal === 'alerts' && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 modal-enter">
              <div className="bg-white rounded-xl p-6 w-full max-w-md text-black">
                <h2 className="text-2xl font-bold mb-4">ğŸ”” Stok UyarÄ±larÄ± ({alerts.length})</h2>
                
                <div className="max-h-96 overflow-y-auto space-y-3 mb-4">
                  {alerts.map(alert => (
                    <div key={alert.id} className="bg-red-50 border-2 border-red-200 rounded-lg p-4">
                      <p className="font-semibold">{alert.product_name || 'ÃœrÃ¼n'}</p>
                      <p className="text-sm text-gray-600">{alert.message}</p>
                    </div>
                  ))}
                </div>
                
                <div className="flex gap-3">
                  <button 
                    onClick={markAlertsAsRead}
                    className="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition"
                  >
                    âœ… Hepsini Okundu Ä°ÅŸaretle
                  </button>
                  <button 
                    onClick={() => setModal('')} 
                    className="flex-1 bg-gray-200 hover:bg-gray-300 py-3 rounded-lg font-semibold transition"
                  >
                    Kapat
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
